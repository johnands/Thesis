\documentclass{beamer}

\usepackage[utf8]{inputenc}
\usepackage{default}
\usepackage{amsmath}
\usepackage{upgreek}
\usepackage{booktabs}

\title{Konstruksjon av høydimensjonale nevralt nettverk-potensialer for molekylærdynamikk}
\author{John-Anders Stende}
\institute{
  Fysisk institutt \\
  Universitetet i Oslo
}
\date{Masterpresentasjon, oktober 2017}
\subject{Computational physics}

\AtBeginSection[]
{
  \begin{frame}
    \frametitle{Table of Contents}
    \tableofcontents[currentsection]
  \end{frame}
}

\begin{document}

\frame{\titlepage}

\section{Molekylærdynamikk}

\begin{frame}

\begin{block}{Hva er molekylærdynamikk?}
  \begin{itemize}
  \item Numerisk metode for å simulere atomers og molekylers bevegelser i gasser, væsker og faste stoffer.
  \item Virtuelt eksperiment.
  \end{itemize}
\end{block}

\end{frame}


\begin{frame}

\begin{block}{Dynamikk}
  \begin{itemize}
  \item Partiklenes interaksjoner styrer dynamikken.
  \item Interaksjonene bestemmes av et kraftfelt $\mathbf{F}$:
    \begin{equation*}
    \mathbf{F} = -\nabla V(\mathbf{r})
    \end{equation*}
  \item Potensiell energiflate / potensial):
    \begin{equation*}
      V(\mathbf{r}), \quad \mathbf{r} = (\mathbf{r}_1, \mathbf{r}_2, \cdots, \mathbf{r}_N)
    \end{equation*}
  \item $V(\mathbf{r})$ inneholder all fysikken. 
  \end{itemize}
\end{block}

\end{frame}


\begin{frame}

\begin{columns}[T] % contents are top vertically aligned
  \begin{column}[T]{0.5\linewidth} % each column can also be its own environment
    \begin{block}{Ab inito molekylærdynamikk}
    Løse Schrödinger-likningen ved hvert tidssteg.
    \end{block}
  \end{column}
  \begin{column}[T]{0.5\linewidth} % alternative top-align that's better for graphics
    \begin{block}{Klassisk molekylærdynamikk}
    Bruke en predefinert analytisk funksjon.
    \end{block}
  \end{column}
\end{columns}

\end{frame}


\begin{frame}

\begin{block}{Klassisk potensial}
  \begin{equation*}
  V(\mathbf{r}) \approx \sum_i^N V_1(\mathbf{r}_i) + \sum_{i,j}^N V_2(\mathbf{r}_i, \mathbf{r}_j) + 
  \sum_{i,j,k}^N V_3(\mathbf{r}_i, \mathbf{r}_j, \mathbf{r}_k) + \dots
  \end{equation*}
\end{block}

\begin{block}{Hvordan bør leddene se ut?}
Eksperiementer / kvantemekanikk
\end{block}

\end{frame}


\begin{frame}

\begin{block}{''Fysisk'' strategi:}
 \begin{enumerate}
  \item Starte med en funksjonsform med noen parametre.
  \item Bestemme parametre fra eksperimentelle data.
 \end{enumerate}
\end{block}

\begin{block}{''Matematisk'' strategi:}
 \begin{enumerate}
  \item Produsere kvantemekaniske data. 
  \item Tilpasse en generell funksjonsform til dataene.
 \end{enumerate}
\end{block}

\end{frame}


\begin{frame}
 
\begin{block}{Interpolere datasett}
 \begin{itemize}
  \item Spliner
  \item Minste kvadraters metode
  \item Maskinlæring
 \end{itemize}
\end{block}
 
\end{frame}


\section{Nevrale nettverk}

\begin{frame}
 
\includegraphics[width=0.9\linewidth]{../Figures/Theory/MachineLearningDiagram.png}

\end{frame}


\begin{frame}

\begin{block}{Kunstige nevrale nettverk}
 \begin{itemize}
  \item Etterlikne en biologisk hjerne
  \item Nettverk av matematiske nevroner
 \end{itemize}
\end{block}


\end{frame}


\begin{frame}
 
\centering
\includegraphics[width=0.8\linewidth]{../Figures/Theory/neuron_anatomy.jpg} 

\includegraphics[width=0.8\linewidth]{../Figures/Theory/neuron.pdf} 

\end{frame}


\begin{frame}

\centering
\includegraphics[width=0.8\linewidth]{../Figures/Theory/neuron.pdf} 

\begin{equation*}
 y = f\left(\sum_{i=1}^n w_ix_i + b_i\right) = f(u)
\end{equation*}
 
\end{frame}


\begin{frame}
 
\centering
\includegraphics[width=0.9\linewidth]{../Figures/Theory/networkGeneralAltered.pdf}

\end{frame}


\begin{frame}
 
\centering
\includegraphics[width=0.8\linewidth]{../Figures/Theory/networkWithNotationAltered.pdf}

\begin{equation*}
 y_i^1 = f_1(u_i^1) = f_1\left(\sum_{j=1}^2 w_{ij}^1 x_j  + b_i^1\right)
\end{equation*}

\end{frame}


\begin{frame}

\begin{equation*}
  y_1^3 = f_3\left[\sum_{j=1}^3 w_{1j}^3 f_2\left(\sum_{k=1}^3 w_{jk}^2 f_1\left(\sum_{m=1}^2 w_{km}^1 x_m + b_k^1\right) + b_j^2\right)
  + b_1^3\right]
\end{equation*}
\begin{equation*}
 h(x) = c_1 f(c_2 x + c_3) + c_4
\end{equation*}
\centering
\includegraphics[width = 0.7\linewidth]{../Figures/Theory/activationFlex.pdf}

\end{frame}
 
 
\begin{frame}{Matrix notation}

\begin{equation*}
  y_i^2 = f_2\left(\sum_{j=1}^3 w_{ij}^2 y_j^1 + b_i^2\right)
\end{equation*}
\begin{equation*}
 \mathbf{y}_2 = f_2(\mathrm{W}_2 \mathbf{y}_{1} + \mathbf{b}_{2}) = 
 f_2\left(\left[\begin{array}{ccc}
    w^2_{11} &w^2_{12} &w^2_{13} \\
    w^2_{21} &w^2_{22} &w^2_{23} \\
    w^2_{31} &w^2_{32} &w^2_{33} \\
    \end{array} \right] \cdot
    \left[\begin{array}{c}
           y^1_1 \\
           y^1_2 \\
           y^1_3 \\
          \end{array}\right] + 
    \left[\begin{array}{c}
           b^2_1 \\
           b^2_2 \\
           b^2_3 \\
          \end{array}\right]\right)
\end{equation*}

\end{frame}


\begin{frame}{Activation functions}

\begin{columns}[T] % contents are top vertically aligned

 \begin{column}[T]{0.5\linewidth} % each column can also be its own environment
  The sigmoid
  \begin{equation*}
  f(x) = \frac{1}{1 + e^{-x}}
  \label{sigmoidActivationFunction}
  \end{equation*}
  and the hyperbolic tangent
  \begin{equation*}
  f(x) = \tanh(x)
  \label{tanhActivationFunction}
  \end{equation*}
 \end{column}
 
 \begin{column}[T]{0.5\linewidth} % alternative top-align that's better for graphics
  \centering
  \includegraphics[width=\linewidth]{../Figures/Theory/activationFunctionsAltered.pdf}
 \end{column}
 
\end{columns}
  
\end{frame}


\begin{frame}
 
\centering
\includegraphics[width=0.9\linewidth]{../Figures/Presentation/interpolation.pdf}
\begin{block}{Regresjon med nevralt nettverk}
 \begin{itemize}
  \item Regresjon: Interpolere datasett $\mathrm{X} \rightarrow \mathrm{Y}$
  \item $X$: inputdata, $Y$: outputdata, $X_{i*}$: treningseksempel. 
  \item Trening: Iterativt minimere feilen til et sett med kjente energier. 
 \end{itemize}
\end{block}

\end{frame}


\begin{frame}
 
\begin{block}{Feilen defineres ved en cost-funksjon:} 
 \begin{equation*}
 \Gamma = \Gamma\bigr(\{\mathrm{W}_l\}, \{\mathbf{b}_l\}, \mathrm{X}, \mathrm{Y}\bigr)
        = \frac{1}{2N}\sum_{i=1}^N (Y_i - y_i)^2
 \end{equation*}
\end{block}

\begin{block}{Optimering med gradient descent:}
 \begin{equation*}
  \mathbf{\uptheta}_{k+1} = \mathbf{\uptheta}_{k} - \gamma \nabla_{\mathbf{\uptheta}_k} \Gamma(\mathbf{\uptheta})
 \end{equation*}
 Mange forskjellige måter å justere $\gamma$ på. 
\end{block}

\end{frame}


\begin{frame}{Hvordan finne gradienten av nettet?}
 
\centering
\includegraphics[width = 0.8\linewidth]{../Figures/Theory/backprop.pdf}

\begin{block}{Backpropagation}
 \begin{enumerate}
  \item Sender hvert treningsseksempel gjennom nettet. 
  \item Output (energi) sammenliknes med kjent energi. 
  \item Feilen propagares \textit{bakover} ved kjerneregelen og vektene justeres. 
 \end{enumerate}
\end{block}
 
\end{frame}

\section{Nevralt nettverk-potensial}

\begin{frame}
 
\begin{block}{Flere muligheter}
 \begin{itemize}
  \item Et eller flere nettverk? 
  \item Hvordan representere energien?
 \end{itemize}
\end{block}

\begin{block}{Behler-Parrinello-metoden}
 \begin{equation*}
       E = \sum_{i=1}^N E_i
 \end{equation*}
 \begin{itemize}
  \item Atomsentrert: Hver atomenergi $E_i$ avhenger av alle naboatomer opp til en cutoff $r_c$.
  \item Hvert atom har et eget nettverk og et sett av symmetrifunksjoner som beskriver cutoff-kulen. 
  \item Hver atomtype har identiske nettverk og symmetryfunskjonssett.  
 \end{itemize}
\end{block}

\end{frame}


\begin{frame}

\begin{columns}[c] % contents are top vertically aligned
  \begin{column}[c]{0.35\linewidth} % each column can also be its own environment
   \centering
   \includegraphics[width=\linewidth]{../Figures/Presentation/cutoffSphere.pdf}
  \end{column}
  \begin{column}[c]{0.65\linewidth} % alternative top-align that's better for graphics
   \includegraphics[width=\linewidth]{../Figures/Presentation/BehlerParrinello.pdf}
  \end{column}
\end{columns}

\end{frame}


\begin{frame}

\begin{block}{Cutoff-funksjon}
 
 \begin{equation*}
  f_c(r_{ij}) = 
  \begin{cases}
   0.5 \!\left[\cos\left(\frac{\pi r_{ij}}{r_c}\right) + 1 \right], & r_{ij} \leq r_c \\
   0, & r_{ij} > r_c
  \end{cases}
 \end{equation*}
 \centering
 \includegraphics[width=0.7\linewidth]{../Figures/Presentation/cutoffFunction.pdf}
\end{block}

\end{frame}


\begin{frame}{Radiell symmetrifunksjon}

\begin{equation*}
 G_i^2 = \sum_{j=1}^N \exp[-\eta(r_{ij}-r_s)^2] \,f_c(r_{ij})
\end{equation*}

\begin{columns} % contents are top vertically aligned
  \begin{column}{0.5\linewidth} % each column can also be its own environment
   \centering
   \includegraphics[width=\linewidth]{../Figures/Presentation/G2_1.pdf}
  \end{column}
  \begin{column}{0.5\linewidth} % alternative top-align that's better for graphics
   \centering
   \includegraphics[width=\linewidth]{../Figures/Presentation/G2_2.pdf}
  \end{column}
\end{columns}

\end{frame}


\begin{frame}{Angulær symmetrifunksjon}

\begin{equation*}
  G_i^5 = 2^{1-\zeta}\sum_{j\neq i}\sum_{k>j} \Big[(1 + \lambda \cos\theta_{jik})^\zeta \,
 \exp(-\eta (r_{ij}^2 + r_{ik}^2)) \,
 &f_c(r_{ij}) f_c(r_{ik})\Big]
\end{equation*}
\centering
\includegraphics[width=0.17\linewidth]{../Figures/Presentation/triplet.pdf}

\begin{columns} % contents are top vertically aligned
  \begin{column}{0.5\linewidth} % each column can also be its own environment
   \centering
   $\lambda = +1$
   \includegraphics[width=\linewidth]{../Figures/Presentation/G4G5angular1.pdf}
  \end{column}
  \begin{column}{0.5\linewidth} % alternative top-align that's better for graphics
   \centering
   $\lambda = -1$
   \includegraphics[width=\linewidth]{../Figures/Presentation/G4G5angular2.pdf}
  \end{column}
\end{columns}

\end{frame}


\begin{frame}{Krefter}

\begin{equation*}
 E_i = \mathrm{NN}_e[\mathbf{G}_e(\mathbf{r}_{ij})]
\end{equation*}

\begin{equation*}
  F_{i,x} = -\sum_{i=1}^{N_i+1}\frac{\partial E_j}{\partial x} = 
 -\sum_{j=1}^{N_i+1}\sum_{s=1}^{M_j}\frac{\partial E_j}{\partial G_{j,s}}\frac{\partial G_{j,s}}{\partial x}
\end{equation*}

\end{frame}


\section{LAMMPS og TensorFlow}


\begin{frame}

\begin{block}{LAMMPS}
 \begin{itemize}
  \item Simuleringspakke for klassisk molekylærdynamikk utviklet ved Sandia National Laboratories. 
  \item Kjøres ved inputscripts med egen syntaks. 
  \item Vi har utvidet med samplingsalgoritme og nevralt nettverk-potensial.
 \end{itemize}
\end{block}

\end{frame}


\begin{frame}

\begin{block}{TensorFlow}
 \begin{itemize}
  \item Maskinlæringspakke utviklet av Google. 
  \item Setter opp nevrale nettverk som data flow-grafer (DFG). 
  \item DFG: En graf bestående av \textit{noder} som er forbundet av \textit{kanter} med retning. 
  \item Noder er matematiske operasjoner, kanter er tensorer. 
 \end{itemize}
\end{block}

\end{frame}


\begin{frame}
 
\centering
\includegraphics[width=0.4\linewidth]{../Figures/Implementation/DFG.pdf} 

\begin{columns} % contents are top vertically aligned
  \begin{column}{0.5\linewidth} % each column can also be its own environment
   \begin{equation*}
    ax^2 + bx + c = 0
   \end{equation*}
  \end{column}
  \begin{column}{0.5\linewidth} % alternative top-align that's better for graphics
   \begin{align*}
    x_1 &= \frac{-b + \sqrt{b^2 - 4ac}}{2a}  \label{quadraticEquationSolution1} \\
    x_2 &= \frac{-b - \sqrt{b^2 - 4ac}}{2a}
   \end{align*}
  \end{column}
\end{columns}

\end{frame}


\begin{frame}
 
\centering
\includegraphics[width=0.7\linewidth]{../Figures/Implementation/tensorBoardTraining.pdf} 
 
\end{frame}


\section{Konstruksjon av nevralt nettverk-potensial (NNP)}


\begin{frame}

\begin{enumerate}
 \item Generere treningsdata som er relevant for applikasjonen av NNP. 
 \item Trene et nevralt nettverk for å tilpasse en funksjon til dataene. 
 \item Bruke det trente nettverket som et analytisk potensial i molekylærdynamikksimuleringer. 
\end{enumerate}

\end{frame}


\begin{frame}
 
\centering
\includegraphics[width=0.7\linewidth]{../Figures/Presentation/iterativeSampling.pdf} 

\end{frame}


\section{NNP for Si}


\begin{frame}

\begin{block}{Initiell sampling}
 \begin{itemize}
  \item Stillinger-Weber. 
  \item $T \in [0,500]$ K. 
  \item Konfigurasjoner og energies samples med samplingsalgoritme.  
 \end{itemize}
\end{block}

\end{frame}


\begin{frame}

\begin{columns} % contents are top vertically aligned
  \begin{column}{0.5\linewidth} % each column can also be its own environment
   \centering
   Radielle
   \includegraphics[width=\linewidth]{../Figures/Presentation/SiInitialSymmG2.pdf}
  \end{column}
  \begin{column}{0.5\linewidth} % alternative top-align that's better for graphics
   \centering
   Angulære
   \includegraphics[width=\linewidth]{../Figures/Presentation/SiInitialSymmG5.pdf}
  \end{column}
\end{columns}
 
\end{frame}


\begin{frame}

\begin{block}{Ekstrapolasjon}
 Lagre max og min for hver symmetryfunksjon. 
\end{block}

\begin{block}{Interpolasjon - multiple-NN-metoden}
 \centering
 \includegraphics[width = 0.7\linewidth]{../Figures/Results/multipleNNP.pdf}
\end{block}

\end{frame}


\begin{frame}{Gridsøk}
 
\renewcommand{\arraystretch}{0.9}
\begin{table} 
\centering
  \begin{tabular*}{10cm}{l @{\extracolsep{\fill}} llll}
    \toprule
    Layers & Nodes & RMSE & Epoch & Time \\ 
    \hline
    $L=1$ & 4  & 4.445 & 37035 & 575 \\
	  & 8  & 2.250 & 37305 & 570 \\
	  & 12 & 2.303 & 37980 & 622 \\
	  & 16 & 2.201 & 39780 & 630 \\
	  & 20 & 1.860 & 36180 & 617 \\ 
	  & 24 & 1.928 & 37305 & 621 \\
	  & 28 & 2.407 & 39375 & 697 \\
	  & 32 & 2.214 & 38700 & 672 \\
    $L=2$ & 4  & 2.947 & 39960 & 750 \\
	  & 8  & 1.933 & 36180 & 671 \\
	  & 12 & 1.450 & 37350 & 766 \\
	  & 16 & 1.791 & 32265 & 633 \\
	  & 20 & 1.492 & 24840 & 546 \\
	  & 24 & 2.118 & 37620 & 819 \\
	  & 28 & 1.455 & 37350 & 895 \\
	  & 32 & 2.008 & 14895 & 344 \\
    \bottomrule
    \end{tabular*} 
\end{table}

\end{frame}


\begin{frame}
 
\begin{block}{Tilpasse endelig treningssett}
 Velger nettet med lavest RMSE etter 40000 epoker. RMSE: 0.864 meV.
\end{block}

\begin{block}{RMSE krefter}
 \centering
 RMSE: 41.2 meV
 \includegraphics[width = 0.7\linewidth]{../Figures/Results/SiForces.pdf}
\end{block}

\end{frame}


\begin{frame}

\begin{block}{Radiell distribusjonsfunksjon $g(r)$}
 Sammenlikner tidsmidlet SW og NN.
 \centering
 \includegraphics[width = 0.7\linewidth]{../Figures/Results/radialDist.pdf}
\end{block}

\end{frame}


\begin{frame}
 
\begin{block}{Mekaniske egenskaper}
 \begin{table}
 \centering
    \begin{tabular*}{10cm}{l @{\extracolsep{\fill}} lll}
      \toprule
      & NNP & Analytic SW & Relative error  \\ 
      \hline
      Bulk modulus    & 103.0  & 101.4 &  1.58 \% \\
      Shear modulus   & 53.6   & 56.4  &  5.22 \% \\
      Poisson ratio   & 0.348  & 0.335 &  3.88 \% \\
      \bottomrule
      \end{tabular*} 
 \end{table}
\end{block}

\end{frame}


\section{Konklusjon og fremtidig arbeid}


\begin{frame}

\begin{block}{Det ideelle potensial}
 \begin{itemize}
  \item Potensialet bør være nøyaktig.
        
  \item Burde finnes måter å systematisk forbedre potensialet.
        
  \item Potensialet bør være generelt og anvendbart på alle typer systemer.
	
  \item Potensialet bør kunne modellere faseoverganger.
	
  \item Potensialet bør være høydimensjonalt, dvs. avhenge av alle frihetsgrader.

 \end{itemize}
\end{block}

\end{frame}


\begin{frame}

\begin{block}{Det ideelle potensial fortsetter}
 \begin{itemize}
  \item Konstruksjonen av potensialet bør være så automatisert som mulig.
  \item Potensialet bør være prediktivt. 
  \item Potensialet bør være raskt å evaluere.
  \item Konstruksjonen bør ikke ta for mye tid. 
  \item Analytisk derivert bør være tilgjengelig. 
 \end{itemize}
\end{block}

\end{frame}


\begin{frame}

\begin{block}{Fremtidig arbeid}
 \begin{itemize}
  \item \textit{Ab inito} data. 
  \item Mer nøyaktige krefter. 
  \item Andre systemer. 
  \item Optimering. 
 \end{itemize}
\end{block}

\end{frame}






\end{document}
